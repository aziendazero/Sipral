<?xml version="1.0" encoding="UTF-8"?>

<process-definition  xmlns=""  name="manageImpianti">


	<start-state name="start-state1">
		<transition to="backup PG"></transition>
	</start-state>


	<decision name="Button1?" expression="#{button.mnemonic}">
		<transition to="saved?" name="BtnImpMng"></transition>
		<transition to="Eject" name="BtnImpAdd"></transition>
		<transition to="Button5?" name="BtnImp"></transition>
		<transition to="Button5?" name="BtnImpPerSi"></transition>
		<transition to="Button5?" name="BtnImpAnag"></transition>
		<transition to="VenditaCessioneMulti" name="BtnImpSellMulti"></transition>
		<transition to="popup delete imp" name="BtnImpDel"></transition>
	</decision>

	<node name="Set SI 01">
		<event type="node-enter">
			<action name="1" expression="#{not empty Sedi?ImpPress.setSedi(Sedi):''}"></action>
			<action name="2" expression="#{not empty IndirizzoSped?ImpPress.setIndirizzoSped(IndirizzoSped):''}"></action>
		</event>
		<transition to="is impianto valid 01?" name=""></transition>
	</node>

	<task-node name="Select Sede SI">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setViewId('/MOD_Company/CORE/FORMS/selectSede_SedeInst')}"></action>
		</event>
		<transition to="Button2?"></transition>
	</task-node>

	<decision name="Button2?" expression="#{button.mnemonic}">
		<transition to="eject" name="BtnBack"></transition>
		<transition to="Inject SI" name="SedeSelected"></transition>
		<transition to="inject SA list 2" name="BtnSelect"></transition>
		<transition to="Inject SI" name="ImpiantoPerSi"></transition>
	</decision>

	<task-node name="Select Type">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setPopupViewId('/MOD_Company/CORE/FORMS/popupSelectImpType')}"></action>
		</event>
		<transition to="Button3?"></transition>
	</task-node>

	<decision name="Button3?" expression="#{button.mnemonic}">
		<transition to="eject impianto2" name="BtnCancel"></transition>
		<transition to="Inject New" name="BtnSelect"></transition>
	</decision>

	<task-node name="Crea Impianto">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setViewId('/MOD_Company/CORE/FORMS/create_impianto')}"></action>
		</event>
		<transition to="Button4?"></transition>
	</task-node>

	<node name="Inject New">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.getSelectedType() eq '01'?ImpPressAction.inject(ImpPressAction.newEntity()):''}"></action>
			<action name="2" expression="#{ImpiantoAction.getSelectedType() eq '02'?ImpRiscAction.inject(ImpRiscAction.newEntity()):''}"></action>
			<action name="3" expression="#{ImpiantoAction.getSelectedType() eq '03'?ImpMontaAction.inject(ImpMontaAction.newEntity()):''}"></action>
			<action name="4" expression="#{ImpiantoAction.getSelectedType() eq '04'?ImpSollAction.inject(ImpSollAction.newEntity()):''}"></action>
			<action name="5" expression="#{ImpiantoAction.getSelectedType() eq '05'?ImpTerraAction.inject(ImpTerraAction.newEntity()):''}"></action>
		</event>
		<transition to="auto fill"></transition>
	</node>

	<super-state name="super-state1">
		<node name="Save 01">
			<event type="node-enter">
				<action name="1" expression="#{ImpPressAction.create()}"></action>
				<action name="2" expression="#{ImpPress.setUtenteUltimaModifica(userBean.getCurrentEmployee())}"></action>
				<action name="3" expression="#{ImpPress.setDataUltimaModifica(function.currentDateTime())}"></action>
				<action name="4" expression="#{ImpiantoAction.inject(ImpPress)}"></action>
				<action name="5" expression="#{ImpiantoAction.updateCollectors(ImpPress)}"></action>
				<action name="6" expression="#{SediInstallazione.deletable ? SediInstallazione.setDeletable(false) : ''}"></action>
			</event>
			<transition to="../coming from anag?"></transition>
		</node>
	</super-state>

	<decision name="Button4?" expression="#{button.mnemonic}">
		<transition to="status ok?" name="BtnSaveImp"></transition>
		<transition to="eject" name="BtnBack"></transition>
		<transition to="SelectSa" name="selectSA"></transition>
		<transition to="GestioneGeneratori" name="BtnSG"></transition>
		<transition to="GestioneVasi" name="BtnSV"></transition>
		<transition to="Impianto?" name="selectIS"></transition>
		<transition to="Set Temporary PG" name="BtnSearchPG"></transition>
		<transition to="GestioneVerifiche" name="BtnIspAnag"></transition>
		<transition to="inject specific" name="BtnGestImpAlfrescoDocEdit"></transition>
		<transition to="inject specific ver" name="BtnGestVerAlfrescoDocEdit"></transition>
		<transition to="VenditaCessione" name="BtnCessioneImp"></transition>
		<transition to="VenditaCessione" name="BtnCessioneImpHist"></transition>
		<transition to="VenditaCessione" name="BtnMoveImp"></transition>
		<transition to="gestione sistemi indivisibili" name="manageIndiv"></transition>
		<transition to="SetCheck" name="BtnCheckDuplicated"></transition>
		<transition to="Edit SiglaMatricolaTipoAnno" name="BtnEdit"></transition>
		<transition to="StatusHistory" name="StatusHistory"></transition>
		<transition to="Set Temporary ditta" name="operation"></transition>
	</decision>

	<node name="eject">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.temporary.remove('impType')}"></action>
			<action name="2" expression="#{SediInstallazioneAction.refresh()}"></action>
			<action name="3" expression="#{SediAction.eject()}"></action>
			<action name="4" expression="#{ImpiantoAction.refresh()}"></action>
			<action name="5" expression="#{ImpiantoAction.eject()}"></action>
			<action name="6" expression="#{ImpiantoAction.ejectList()}"></action>
			<action name="7" expression="#{ImpPressAction.eject()}"></action>
			<action name="8" expression="#{ImpRiscAction.eject()}"></action>
			<action name="9" expression="#{ImpMontaAction.eject()}"></action>
			<action name="10" expression="#{ImpSollAction.eject()}"></action>
			<action name="11" expression="#{ImpTerraAction.eject()}"></action>
			<action name="12" expression="#{SchedaVasiAction.eject()}"></action>
			<action name="13" expression="#{SchedaVasiAction.ejectList()}"></action>
			<action name="14" expression="#{SchedaGeneratoriAction.eject()}"></action>
			<action name="15" expression="#{SchedaGeneratoriAction.ejectList()}"></action>
			<action name="16" expression="#{VerificaImpAction.eject()}"></action>
			<action name="17" expression="#{VerificaImpAction.ejectList()}"></action>
			<action name="18" expression="#{VerificaLastAction.eject()}"></action>
			<action name="19" expression="#{SchedaGeneratoriIndivAction.eject()}"></action>
			<action name="20" expression="#{SchedaGeneratoriIndivAction.ejectList()}"></action>
			<action name="21" expression="#{SchedaRecipientiIndivAction.eject()}"></action>
			<action name="22" expression="#{SchedaRecipientiIndivAction.ejectList()}"></action>
			<action name="23" expression="#{SchedaTubazioniIndivAction.eject()}"></action>
			<action name="24" expression="#{SchedaTubazioniIndivAction.ejectList()}"></action>
			<action name="25" expression="#{IndirizzoSpedAction.eject()}"></action>
			<action name="26" expression="#{IndirizzoSpedAction.ejectList()}"></action>
			<action name="27" expression="#{(ImpiantoAction.temporary.get('esattaContiene')=='Esatta' and false) ? ImpiantoAction.cleanRestrictions() : ''}"></action>
		</event>
		<transition to="restore PG"></transition>
	</node>

	<node name="Inject Specific">
		<event type="node-enter">
			<action name="1" expression="#{SediAction.cleanRestrictions()}"></action>
			<action name="2" expression="#{SediAction.equal.put('isActive',true)}"></action>
			<action name="3" expression="#{SediAction.equal.put('personaGiuridica.internalId',(Impianto.sedeInstallazione.sede eq null?-1:Impianto.sedeInstallazione.sede.personaGiuridica.internalId))}"></action>
			<action name="4" expression="#{SediAction.equal.put('sedeAddebito',true)}"></action>
			<action name="5" expression="#{SediAction.notEqual.put('copy',true)}"></action>
			<action name="6" expression="#{SediAction.read()}"></action>
			<action name="7" expression="#{IndirizzoSpedAction.injectList(Impianto.sedi.indirizzoSped)}"></action>
			<action name="8" expression="#{Impianto.code.code eq '01'? ImpPressAction.inject(Impianto):''}"></action>
			<action name="9" expression="#{Impianto.code.code eq '02'? ImpRiscAction.inject(Impianto):''}"></action>
			<action name="10" expression="#{Impianto.code.code eq '03'? ImpMontaAction.inject(Impianto):''}"></action>
			<action name="11" expression="#{Impianto.code.code eq '04'? ImpSollAction.inject(Impianto):''}"></action>
			<action name="12" expression="#{Impianto.code.code eq '05'? ImpTerraAction.inject(Impianto):''}"></action>
			<action name="13" expression="#{SediAction.eject()}"></action>
			<action name="14" expression="#{SediAction.inject(Impianto.sedi)}"></action>
			<action name="15" expression="#{Impianto.code.code eq '02'? SchedaGeneratoriAction.injectList(ImpRisc.schedaGeneratori):''}"></action>
			<action name="16" expression="#{Impianto.code.code eq '02'? SchedaVasiAction.injectList(ImpRisc.schedaVasi):''}"></action>
			<action name="17" expression="#{(Impianto.code.code eq '01' and ImpPress.tipoApparecchio.code eq '12') ? SchedaGeneratoriIndivAction.injectList(ImpPress.schedaGeneratoriIndiv) :''}"></action>
			<action name="18" expression="#{(Impianto.code.code eq '01' and ImpPress.tipoApparecchio.code eq '12') ? SchedaRecipientiIndivAction.injectList(ImpPress.schedaRecipientiIndiv) :''}"></action>
			<action name="19" expression="#{(Impianto.code.code eq '01' and ImpPress.tipoApparecchio.code eq '12') ? SchedaTubazioniIndivAction.injectList(ImpPress.schedaTubazioniIndiv) :''}"></action>
			<action name="20" expression="#{SAEsternaAction.cleanRestrictions()}"></action>
			<action name="21" expression="#{SAEsternaAction.equal.put('pgEsterne.internalId',(Impianto.sedeInstallazione.sede eq null?-1:Impianto.sedeInstallazione.sede.personaGiuridica.internalId))}"></action>
			<action name="22" expression="#{SAEsternaAction.read()}"></action>
			<action name="23" expression="#{SediAction.mergeAddebitoLists(SediList, SAEsternaList)}"></action>
			<action name="24" expression="#{SAEsternaAction.ejectList()}"></action>
		</event>
		<transition to="reinject lists one element"></transition>
	</node>

	<super-state name="super-state2">
		<node name="Delete Impianto">
			<event type="node-enter">
				<action name="1" expression="#{ImpiantoAction.unLink('sedeInstallazione',SediInstallazione)}"></action>
				<action name="2" expression="#{ImpiantoAction.clearLinks(Impianto)}"></action>
				<action name="3" expression="#{ImpiantoAction.delete()}"></action>
			</event>
			<transition to="../update SI deletable"></transition>
		</node>
	</super-state>

	<decision name="Impianto?" expression="#{ImpiantoAction.getSelectedType()}">
		<transition to="Set SI 01" name="01"></transition>
		<transition to="Set SI 02" name="02"></transition>
		<transition to="Set SI 03" name="03"></transition>
		<transition to="Set SI 04" name="04"></transition>
		<transition to="Set SI 05" name="05"></transition>
		<transition to="eject" name="exit"></transition>
	</decision>

	<node name="Set SI 02">
		<event type="node-enter">
			<action name="1" expression="#{not empty Sedi?ImpRisc.setSedi(Sedi):''}"></action>
			<action name="2" expression="#{not empty IndirizzoSped?ImpRisc.setIndirizzoSped(IndirizzoSped):''}"></action>
		</event>
		<transition to="is impianto valid 02?"></transition>
	</node>

	<node name="Set SI 03">
		<event type="node-enter">
			<action name="1" expression="#{not empty Sedi?ImpMonta.setSedi(Sedi):''}"></action>
			<action name="2" expression="#{not empty IndirizzoSped?ImpMonta.setIndirizzoSped(IndirizzoSped):''}"></action>
		</event>
		<transition to="is impianto valid 03?"></transition>
	</node>

	<node name="Set SI 05">
		<event type="node-enter">
			<action name="1" expression="#{not empty Sedi?ImpTerra.setSedi(Sedi):''}"></action>
			<action name="2" expression="#{not empty IndirizzoSped?ImpTerra.setIndirizzoSped(IndirizzoSped):''}"></action>
		</event>
		<transition to="is impianto valid 05?"></transition>
	</node>

	<node name="Set SI 04">
		<event type="node-enter">
			<action name="1" expression="#{not empty Sedi?ImpSoll.setSedi(Sedi):''}"></action>
			<action name="2" expression="#{not empty IndirizzoSped?ImpSoll.setIndirizzoSped(IndirizzoSped):''}"></action>
		</event>
		<transition to="is impianto valid 04?"></transition>
	</node>

	<super-state name="super-state3">
		<node name="Save 02">
			<event type="node-enter">
				<action name="1" expression="#{ImpRiscAction.create()}"></action>
				<action name="2" expression="#{ImpRiscAction.updatePot()}"></action>
				<action name="3" expression="#{ImpRisc.setUtenteUltimaModifica(userBean.getCurrentEmployee())}"></action>
				<action name="4" expression="#{ImpRisc.setDataUltimaModifica(function.currentDateTime())}"></action>
				<action name="5" expression="#{ImpiantoAction.inject(ImpRisc)}"></action>
				<action name="6" expression="#{ImpiantoAction.updateCollectors(ImpRisc)}"></action>
				<action name="7" expression="#{SediInstallazione.deletable ? SediInstallazione.setDeletable(false) : ''}"></action>
			</event>
			<transition to="../coming from anag?"></transition>
		</node>
	</super-state>

	<super-state name="super-state4">
		<node name="Save 04">
			<event type="node-enter">
				<action name="1" expression="#{ImpSollAction.create()}"></action>
				<action name="2" expression="#{ImpSoll.setUtenteUltimaModifica(userBean.getCurrentEmployee())}"></action>
				<action name="3" expression="#{ImpSoll.setDataUltimaModifica(function.currentDateTime())}"></action>
				<action name="4" expression="#{ImpiantoAction.inject(ImpSoll)}"></action>
				<action name="5" expression="#{ImpiantoAction.updateCollectors(ImpSoll)}"></action>
				<action name="6" expression="#{SediInstallazione.deletable ? SediInstallazione.setDeletable(false) : ''}"></action>
			</event>
			<transition to="../coming from anag?"></transition>
		</node>
	</super-state>

	<super-state name="super-state5">
		<node name="Save 03">
			<event type="node-enter">
				<action name="1" expression="#{ImpMontaAction.create()}"></action>
				<action name="2" expression="#{ImpMonta.setUtenteUltimaModifica(userBean.getCurrentEmployee())}"></action>
				<action name="3" expression="#{ImpMonta.setDataUltimaModifica(function.currentDateTime())}"></action>
				<action name="4" expression="#{ImpiantoAction.inject(ImpMonta)}"></action>
				<action name="5" expression="#{ImpiantoAction.updateCollectors(ImpMonta)}"></action>
				<action name="6" expression="#{SediInstallazione.deletable ? SediInstallazione.setDeletable(false) : ''}"></action>
			</event>
			<transition to="../coming from anag?"></transition>
		</node>
	</super-state>

	<super-state name="super-state6">
		<node name="Save 05">
			<event type="node-enter">
				<action name="1" expression="#{ImpTerraAction.create()}"></action>
				<action name="2" expression="#{ImpTerra.setUtenteUltimaModifica(userBean.getCurrentEmployee())}"></action>
				<action name="3" expression="#{ImpTerra.setDataUltimaModifica(function.currentDateTime())}"></action>
				<action name="4" expression="#{ImpiantoAction.inject(ImpTerra)}"></action>
				<action name="5" expression="#{ImpiantoAction.updateCollectors(ImpTerra)}"></action>
				<action name="6" expression="#{SediInstallazione.deletable ? SediInstallazione.setDeletable(false) : ''}"></action>
			</event>
			<transition to="../coming from anag?"></transition>
		</node>
	</super-state>

	<decision name="Button5?" expression="#{button.value}">
		<transition to="popup delete imp 3" name="del"></transition>
		<transition to="saved?" name="mngPerSi"></transition>
		<transition to="Select Sede SI" name="addPerSi"></transition>
		<transition to="saved?" name="mng"></transition>
		<transition to="Select Sede SI" name="add"></transition>
		<transition to="popup delete imp 3" name="anagDel"></transition>
		<transition to="saved?" name="anagMng"></transition>
		<transition to="Select PG?" name="anagAdd"></transition>
		<transition to="popup delete imp 2" name="del2"></transition>
		<transition to="saved?" name="mngScad"></transition>
		<transition to="popup delete imp 3" name="delScad"></transition>
	</decision>

	<node name="PrepareDelete">
		<event type="node-enter">
			<action name="1" expression="#{Impianto.setSedeInstallazione(null)}"></action>
		</event>
		<transition to="super-state2/Delete Impianto"></transition>
	</node>

	<node name="Inject SI">
		<event type="node-enter"></event>
		<transition to="Select Sede SI"></transition>
	</node>

	<task-node name="SelectSa">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setPopupViewId('/MOD_Company/CORE/FORMS/popupSelectSA')}"></action>
		</event>
		<transition to="Button6?"></transition>
	</task-node>

	<decision name="Button6?" expression="#{button.mnemonic}">
		<transition to="eject SA" name="BtnCancel"></transition>
		<transition to="Inject IndSped2" name="BtnSave"></transition>
	</decision>

	<node name="eject SA">
		<event type="node-enter">
			<action name="1" expression="#{not empty Impianto ? SediAction.eject() : ''}"></action>
			<action name="2" expression="#{not empty Impianto ? IndirizzoSpedAction.eject() : ''}"></action>
			<action name="3" expression="#{org.jboss.seam.core.conversationContext.remove('si')}"></action>
		</event>
		<transition to="injectVerifiche"></transition>
	</node>

	<process-state name="GestioneVasi">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/schedaVasi?stateless=true" binding="late"></sub-process>
		<transition to="Impianto?"></transition>
	</process-state>

	<process-state name="GestioneGeneratori">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/schedaGeneratori" binding="late"></sub-process>
		<transition to="Impianto?"></transition>
	</process-state>

	<node name="Set Temporary">
		<event type="node-enter">
			<action name="1" expression="#{ProtocolloAction.temporary.put('search', true)}"></action>
			<action name="2" expression="#{SediAction.cleanRestrictions()}"></action>
			<action name="3" expression="#{PersoneGiuridicheAction.temporary.put('stopChain',true)}"></action>
		</event>
		<transition to="Search Company"></transition>
	</node>

	<process-state name="Search Company">
		<sub-process name="MOD_Company/CORE/PROCESSES/companiesArpav" binding="late"></sub-process>
		<transition to="Remove Temporary"></transition>
	</process-state>

	<node name="Remove Temporary">
		<event type="node-enter">
			<action name="1" expression="#{ProtocolloAction.temporary.remove('search')}"></action>
			<action name="2" expression="#{PersoneGiuridicheAction.temporary.remove('stopChain')}"></action>
		</event>
		<transition to="Button7?"></transition>
	</node>

	<decision name="Button7?" expression="#{button.mnemonic}">
		<transition to="eject impianto" name="BtnBack"></transition>
		<transition to="Inject SA and SI" name="BtnSave"></transition>
	</decision>

	<node name="Inject SA and SI">
		<event type="node-enter">
			<action name="1" expression="#{SediAction.injectAddebitoWithExternal(PersoneGiuridiche)}"></action>
			<action name="2" expression="#{SediInstallazioneAction.injectList(SediInstallazioneAction.getFullListFromPG(PersoneGiuridiche))}"></action>
			<action name="3" expression="#{SediAction.eject()}"></action>
			<action name="4" expression="#{PersoneGiuridicheAction.eject()}"></action>
			<action name="5" expression="#{PersoneGiuridicheAction.ejectList()}"></action>
		</event>
		<transition to="PG Add?"></transition>
	</node>

	<node name="Inject IndSped2">
		<event type="node-enter">
			<action name="1" expression="#{IndirizzoSpedAction.injectList(Sedi.indirizzoSped)}"></action>
			<action name="2" expression="#{IndirizzoSpedList.size()==1 ? IndirizzoSpedAction.injectFirst() : ''}"></action>
		</event>
		<transition to="Impianto?"></transition>
	</node>

	<node name="injectImp">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.inject(ImpiantoPerSi)}"></action>
		</event>
		<transition to="PrepareDelete"></transition>
	</node>

	<task-node name="Select PG?">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setPopupViewId('/MOD_Company/CORE/FORMS/popup_ditta_nota')}"></action>
		</event>
		<transition to="Button8?"></transition>
	</task-node>

	<decision name="Button8?" expression="#{button.mnemonic}">
		<transition to="Set Temporary" name="Yes"></transition>
		<transition to="eject2" name="No"></transition>
		<transition to="eject impianto" name="BtnCancel"></transition>
	</decision>

	<task-node name="Select Type 2">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setViewId('/MOD_Company/CORE/FORMS/popupSelectImpType')}"></action>
		</event>
		<transition to="Button3?"></transition>
	</task-node>

	<node name="eject2">
		<event type="node-enter">
			<action name="1" expression="#{PersoneGiuridicheAction.eject()}"></action>
			<action name="2" expression="#{PersoneGiuridicheAction.ejectList()}"></action>
			<action name="3" expression="#{SediAction.eject()}"></action>
			<action name="4" expression="#{SediAction.ejectList()}"></action>
			<action name="5" expression="#{SediAction.eject()}"></action>
			<action name="6" expression="#{SediAction.ejectList()}"></action>
			<action name="7" expression="#{SediInstallazioneAction.eject()}"></action>
			<action name="8" expression="#{SediInstallazioneAction.ejectList()}"></action>
			<action name="9" expression="#{IndirizzoSpedAction.eject()}"></action>
			<action name="10" expression="#{IndirizzoSpedAction.ejectList()}"></action>
		</event>
		<transition to="Select Type 2"></transition>
	</node>

	<task-node name="Select Sede SI 2">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setViewId('/MOD_Company/CORE/FORMS/selectSede_SedeInst')}"></action>
		</event>
		<transition to="inject SI 2"></transition>
	</task-node>

	<decision name="Button9?" expression="#{button.mnemonic}">
		<transition to="Select Sede SI 2" name="SedeSelected"></transition>
		<transition to="Inject New" name="BtnSelect"></transition>
		<transition to="eject impianto2" name="BtnBack"></transition>
		<transition to="Select Sede SI 2" name="ImpiantoPerSi"></transition>
	</decision>

	<node name="inject SI 2">
		<event type="node-enter"></event>
		<transition to="Button9?"></transition>
	</node>

	<node name="preset">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.getSelectedType() eq '01'?ImpPress.setCode(vocabularies.getCodeValue('PHIDIC', 'impType', '01', 'C')):''}"></action>
			<action name="2" expression="#{ImpiantoAction.getSelectedType() eq '02'?ImpRisc.setCode(vocabularies.getCodeValue('PHIDIC', 'impType', '02', 'C')):''}"></action>
			<action name="3" expression="#{ImpiantoAction.getSelectedType() eq '03'?ImpMonta.setCode(vocabularies.getCodeValue('PHIDIC', 'impType', '03', 'C')):''}"></action>
			<action name="4" expression="#{ImpiantoAction.getSelectedType() eq '04'?ImpSoll.setCode(vocabularies.getCodeValue('PHIDIC', 'impType', '04', 'C')):''}"></action>
			<action name="5" expression="#{ImpiantoAction.getSelectedType() eq '05'?ImpTerra.setCode(vocabularies.getCodeValue('PHIDIC', 'impType', '05', 'C')):''}"></action>
			<action name="6" expression="#{ImpiantoAction.getSelectedType() eq '01'?ImpPress.setSedeInstallazione(SediInstallazione):''}"></action>
			<action name="7" expression="#{ImpiantoAction.getSelectedType() eq '02'?ImpRisc.setSedeInstallazione(SediInstallazione):''}"></action>
			<action name="8" expression="#{ImpiantoAction.getSelectedType() eq '03'?ImpMonta.setSedeInstallazione(SediInstallazione):''}"></action>
			<action name="9" expression="#{ImpiantoAction.getSelectedType() eq '04'?ImpSoll.setSedeInstallazione(SediInstallazione):''}"></action>
			<action name="10" expression="#{ImpiantoAction.getSelectedType() eq '05'?ImpTerra.setSedeInstallazione(SediInstallazione):''}"></action>
			<action name="11" expression="#{ImpiantoAction.getSelectedType() eq '01'?ImpPressAction.initListe():''}"></action>
			<action name="12" expression="#{ImpiantoAction.getSelectedType() eq '02'?ImpRiscAction.initListe():''}"></action>
			<action name="13" expression="#{ImpiantoAction.getSelectedType() eq '03'?ImpMontaAction.initListe():''}"></action>
			<action name="14" expression="#{ImpiantoAction.getSelectedType() eq '04'?ImpSollAction.initListe():''}"></action>
			<action name="15" expression="#{ImpiantoAction.getSelectedType() eq '05'?ImpTerraAction.initListe():''}"></action>
			<action name="16" expression="#{ImpiantoAction.getSelectedType() eq '01'?ImpPress.setEsonero(vocabularies.getCodeValue('PHIDIC', 'Esonero', '00', 'C')):''}"></action>
			<action name="17" expression="#{SediAction.eject()}"></action>
			<action name="18" expression="#{SediAction.switchListAddebito(SediAddebitoList)}"></action>
			<action name="19" expression="#{SediList.size()==1 ? SediAction.injectFirst() : ''}"></action>
			<action name="20" expression="#{SediList.size()==1 and not empty Sedi ? IndirizzoSpedAction.injectList(Sedi.indirizzoSped) : ''}"></action>
			<action name="21" expression="#{IndirizzoSpedList.size()==1 ? IndirizzoSpedAction.injectFirst() : ''}"></action>
			<action name="22" expression="#{ImpiantoAction.getSelectedType() eq '01'?ImpPress.setIndirizzoSped(IndirizzoSped):''}"></action>
			<action name="23" expression="#{ImpiantoAction.getSelectedType() eq '02'?ImpRisc.setIndirizzoSped(IndirizzoSped):''}"></action>
			<action name="24" expression="#{ImpiantoAction.getSelectedType() eq '03'?ImpMonta.setIndirizzoSped(IndirizzoSped):''}"></action>
			<action name="25" expression="#{ImpiantoAction.getSelectedType() eq '04'?ImpSoll.setIndirizzoSped(IndirizzoSped):''}"></action>
			<action name="26" expression="#{ImpiantoAction.getSelectedType() eq '05'?ImpTerra.setIndirizzoSped(IndirizzoSped):''}"></action>
			<action name="27" expression="#{ImpiantoAction.getSelectedType() eq '01'?ImpPress.setVerificheLong(0):''}"></action>
			<action name="28" expression="#{ImpiantoAction.getSelectedType() eq '02'?ImpRisc.setVerificheLong(0):''}"></action>
			<action name="29" expression="#{ImpiantoAction.getSelectedType() eq '03'?ImpMonta.setVerificheLong(0):''}"></action>
			<action name="30" expression="#{ImpiantoAction.getSelectedType() eq '04'?ImpSoll.setVerificheLong(0):''}"></action>
			<action name="31" expression="#{ImpiantoAction.getSelectedType() eq '05'?ImpTerra.setVerificheLong(0):''}"></action>
		</event>
		<transition to="Crea Impianto"></transition>
	</node>

	<decision name="PG Add?" expression="#{ProtocolloAction.temporary.get('pg') ne null and ProtocolloAction.temporary.get('pg')}">
		<transition to="Select Sede SI 2" name="false"></transition>
		<transition to="Remove Temporary PG" name="true"></transition>
	</decision>

	<node name="Set Temporary PG">
		<event type="node-enter">
			<action name="1" expression="#{ProtocolloAction.temporary.put('pg', true)}"></action>
		</event>
		<transition to="Set Temporary"></transition>
	</node>

	<node name="Remove Temporary PG">
		<event type="node-enter">
			<action name="1" expression="#{ProtocolloAction.temporary.remove('pg')}"></action>
		</event>
		<transition to="Select Sede SI 3"></transition>
	</node>

	<task-node name="Select Sede SI 3">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setViewId('/MOD_Company/CORE/FORMS/selectSede_SedeInst_Simple')}"></action>
		</event>
		<transition to="inject SI 3"></transition>
	</task-node>

	<decision name="Button10?" expression="#{button.mnemonic}">
		<transition to="eject impianto2" name="BtnBack"></transition>
		<transition to="Select Sede SI 3" name="SedeSelected"></transition>
		<transition to="auto fill" name="BtnSelect"></transition>
		<transition to="Select Sede SI 3" name="ImpiantoPerSi"></transition>
	</decision>

	<node name="inject SI 3">
		<event type="node-enter"></event>
		<transition to="Button10?"></transition>
	</node>

	<process-state name="GestioneVerifiche">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/manageVerifiche" binding="late"></sub-process>
		<transition to="saved?"></transition>
	</process-state>

	<node name="injectVerifiche">
		<event type="node-enter">
			<action name="1" expression="#{VerificaImpAction.equal.remove('impPress.internalId')}"></action>
			<action name="2" expression="#{VerificaImpAction.equal.remove('impRisc.internalId')}"></action>
			<action name="3" expression="#{VerificaImpAction.equal.remove('impMonta.internalId')}"></action>
			<action name="4" expression="#{VerificaImpAction.equal.remove('impSoll.internalId')}"></action>
			<action name="5" expression="#{VerificaImpAction.equal.remove('impTerra.internalId')}"></action>
			<action name="6" expression="#{ImpiantoAction.getSelectedType()=='01'?VerificaImpAction.equal.put('impPress.internalId',ImpPress.internalId):''}"></action>
			<action name="7" expression="#{ImpiantoAction.getSelectedType()=='02'?VerificaImpAction.equal.put('impRisc.internalId',ImpRisc.internalId):''}"></action>
			<action name="8" expression="#{ImpiantoAction.getSelectedType()=='03'?VerificaImpAction.equal.put('impMonta.internalId',ImpMonta.internalId):''}"></action>
			<action name="9" expression="#{ImpiantoAction.getSelectedType()=='04'?VerificaImpAction.equal.put('impSoll.internalId',ImpSoll.internalId):''}"></action>
			<action name="10" expression="#{ImpiantoAction.getSelectedType()=='05'?VerificaImpAction.equal.put('impTerra.internalId',ImpTerra.internalId):''}"></action>
			<action name="11" expression="#{VerificaImpAction.orderBy.put('data','descending')}"></action>
			<action name="12" expression="#{VerificaImpAction.notEqual.put('pre',true)}"></action>
			<action name="13" expression="#{VerificaImpAction.read()}"></action>
			<action name="14" expression="#{VerificaLastAction.injectLast(VerificaImpAction.readIncludedPre())}"></action>
		</event>
		<transition to="Crea Impianto"></transition>
	</node>

	<node name="Eject">
		<event type="node-enter">
			<action name="1" expression="#{ImpPressAction.eject()}"></action>
			<action name="2" expression="#{ImpRiscAction.eject()}"></action>
			<action name="3" expression="#{ImpMontaAction.eject()}"></action>
			<action name="4" expression="#{ImpSollAction.eject()}"></action>
			<action name="5" expression="#{ImpTerraAction.eject()}"></action>
			<action name="6" expression="#{IndirizzoSpedAction.eject()}"></action>
			<action name="7" expression="#{IndirizzoSpedAction.ejectList()}"></action>
		</event>
		<transition to="inject only add"></transition>
	</node>

	<node name="inject specific">
		<event type="node-enter">
			<action name="1" expression="#{Impianto.code.code eq '01'? ImpPressAction.inject(Impianto):''}"></action>
			<action name="2" expression="#{Impianto.code.code eq '01'? AlfrescoDocumentAction.temporary.put('entity2Link', ImpPress):''}"></action>
			<action name="3" expression="#{Impianto.code.code eq '01'? AlfrescoDocumentAction.injectList(ImpPress.documenti):''}"></action>
			<action name="4" expression="#{Impianto.code.code eq '02'? ImpRiscAction.inject(Impianto):''}"></action>
			<action name="5" expression="#{Impianto.code.code eq '02'? AlfrescoDocumentAction.temporary.put('entity2Link', ImpRisc):''}"></action>
			<action name="6" expression="#{Impianto.code.code eq '02'? AlfrescoDocumentAction.injectList(ImpRisc.documenti):''}"></action>
			<action name="7" expression="#{Impianto.code.code eq '03'? ImpMontaAction.inject(Impianto):''}"></action>
			<action name="8" expression="#{Impianto.code.code eq '03'? AlfrescoDocumentAction.temporary.put('entity2Link', ImpMonta):''}"></action>
			<action name="9" expression="#{Impianto.code.code eq '03'? AlfrescoDocumentAction.injectList(ImpMonta.documenti):''}"></action>
			<action name="10" expression="#{Impianto.code.code eq '04'? ImpSollAction.inject(Impianto):''}"></action>
			<action name="11" expression="#{Impianto.code.code eq '04'? AlfrescoDocumentAction.temporary.put('entity2Link', ImpSoll):''}"></action>
			<action name="12" expression="#{Impianto.code.code eq '04'? AlfrescoDocumentAction.injectList(ImpSoll.documenti):''}"></action>
			<action name="13" expression="#{Impianto.code.code eq '05'? ImpTerraAction.inject(Impianto):''}"></action>
			<action name="14" expression="#{Impianto.code.code eq '05'? AlfrescoDocumentAction.temporary.put('entity2Link', ImpTerra):''}"></action>
			<action name="15" expression="#{Impianto.code.code eq '05'? AlfrescoDocumentAction.injectList(ImpTerra.documenti):''}"></action>
		</event>
		<transition to="inject addebiti"></transition>
	</node>

	<node name="injectList of docs">
		<event type="node-enter">
			<action name="1" expression="#{AlfrescoDocumentAction.findLastChangeInfo(AlfrescoDocumentList.getList())}}"></action>
			<action name="2" expression="#{ImpiantoAction.temporary.put('impOrVer', 'imp')}"></action>
		</event>
		<transition to="alfrescoDocuments"></transition>
	</node>

	<process-state name="alfrescoDocuments">
		<sub-process name="MOD_Document/CORE/PROCESSES/alfrescoDocument" binding="late"></sub-process>
		<transition to="Crea Impianto"></transition>
	</process-state>

	<node name="inject specific ver">
		<event type="node-enter">
			<action name="1" expression="#{AlfrescoDocumentAction.temporary.put('entity2Link', VerificaImp)}"></action>
			<action name="2" expression="#{AlfrescoDocumentAction.injectList(VerificaImp.documenti)}"></action>
		</event>
		<transition to="injectList of docs ver"></transition>
	</node>

	<node name="injectList of docs ver">
		<event type="node-enter">
			<action name="1" expression="#{AlfrescoDocumentAction.findLastChangeInfo(AlfrescoDocumentList.getList())}"></action>
			<action name="2" expression="#{ImpiantoAction.temporary.put('impOrVer', 'ver')}"></action>
		</event>
		<transition to="alfrescoDocuments"></transition>
	</node>

	<decision name="is impianto valid 01?" expression="#{ImpPressAction.checkImpPress(ImpPress)}">
		<transition to="collector" name="false"></transition>
		<transition to="super-state1/Save 01" name="true"></transition>
	</decision>

	<decision name="is impianto valid 02?" expression="#{ImpRiscAction.checkImpRisc(ImpRisc)}">
		<transition to="super-state3/Save 02" name="true"></transition>
		<transition to="collector" name="false"></transition>
	</decision>

	<node name="collector">
		<transition to="eject SA"></transition>
	</node>

	<decision name="is impianto valid 03?" expression="#{ImpMontaAction.checkImpMonta(ImpMonta)}">
		<transition to="super-state5/Save 03" name="true"></transition>
		<transition to="collector" name="false"></transition>
	</decision>

	<decision name="is impianto valid 04?" expression="#{ImpSollAction.checkImpSoll(ImpSoll)}">
		<transition to="super-state4/Save 04" name="true"></transition>
		<transition to="collector" name="false"></transition>
	</decision>

	<decision name="is impianto valid 05?" expression="#{ImpTerraAction.checkImpTerra(ImpTerra)}">
		<transition to="super-state6/Save 05" name="true"></transition>
		<transition to="collector" name="false"></transition>
	</decision>

	<process-state name="VenditaCessione">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/venditaCessione" binding="late"></sub-process>
		<transition to="saved?"></transition>
	</process-state>

	<process-state name="VenditaCessioneMulti">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/venditaCessioneMulti" binding="late"></sub-process>
		<transition to="to End"></transition>
	</process-state>

	<process-state name="gestione sistemi indivisibili">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/addScheda" binding="late"></sub-process>
		<transition to="Crea Impianto"></transition>
	</process-state>

	<node name="inject SA list 2">
		<event type="node-enter">
			<action name="1" expression="#{SediAction.injectAddebitoWithExternal(PersoneGiuridiche)}"></action>
		</event>
		<transition to="Button3?" name=""></transition>
	</node>

	<node name="inject only add">
		<event type="node-enter">
			<action name="1" expression="#{SediAction.injectAddebitoWithExternal(PersoneGiuridiche)}"></action>
		</event>
		<transition to="Select Type"></transition>
	</node>

	<decision name="saved?" expression="#{not empty Impianto}">
		<transition to="Inject Specific" name="true"></transition>
		<transition to="inject for unsaved" name="false"></transition>
	</decision>

	<node name="reinject lists one element">
		<event type="node-enter">
			<action name="1" expression="#{SediList.size()==1 ? SediAction.injectFirst() : ''}"></action>
			<action name="2" expression="#{SediList.size()==1 and not empty Sedi ? IndirizzoSpedAction.injectList(Sedi.indirizzoSped) : ''}"></action>
			<action name="3" expression="#{IndirizzoSpedList.size()==1 ? IndirizzoSpedAction.injectFirst() : ''}"></action>
			<action name="4" expression="#{ImpiantoAction.temporary.put('lastDate',Impianto.dataVariazioneStato)}"></action>
		</event>
		<transition to="injectVerifiche"></transition>
	</node>

	<node name="inject for unsaved">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.getSelectedType() eq '01' ? SediAction.equal.put('personaGiuridica',ImpPress.sedeInstallazione.sede.personaGiuridica) : ''}"></action>
			<action name="2" expression="#{ImpiantoAction.getSelectedType() eq '02' ? SediAction.equal.put('personaGiuridica',ImpRisc.sedeInstallazione.sede.personaGiuridica) : ''}"></action>
			<action name="3" expression="#{ImpiantoAction.getSelectedType() eq'03' ? SediAction.equal.put('personaGiuridica',ImpMonta.sedeInstallazione.sede.personaGiuridica) : ''}"></action>
			<action name="4" expression="#{ImpiantoAction.getSelectedType() eq '04' ? SediAction.equal.put('personaGiuridica',ImpSoll.sedeInstallazione.sede.personaGiuridica) : ''}"></action>
			<action name="5" expression="#{ImpiantoAction.getSelectedType() eq '05' ? SediAction.equal.put('personaGiuridica',ImpTerra.sedeInstallazione.sede.personaGiuridica) : ''}"></action>
			<action name="6" expression="#{SediAction.equal.put('sedeAddebito',true)}"></action>
			<action name="7" expression="#{SediAction.read()}"></action>
			<action name="8" expression="#{SediAction.eject()}"></action>
			<action name="9" expression="#{ImpiantoAction.getSelectedType() eq '01' ? SediAction.inject(ImpPress.sedi) : ''}"></action>
			<action name="10" expression="#{ImpiantoAction.getSelectedType() eq '02' ? SediAction.inject(ImpRisc.sedi) : ''}"></action>
			<action name="11" expression="#{ImpiantoAction.getSelectedType() eq '03' ? SediAction.inject(ImpMonta.sedi) : ''}"></action>
			<action name="12" expression="#{ImpiantoAction.getSelectedType() eq '04' ? SediAction.inject(ImpSoll.sedi) : ''}"></action>
			<action name="13" expression="#{ImpiantoAction.getSelectedType() eq '05' ? SediAction.inject(ImpTerra.sedi) : ''}"></action>
			<action name="14" expression="#{ImpiantoAction.getSelectedType() eq '01' ? IndirizzoSpedAction.injectList(ImpPress.sedi.indirizzoSped) : ''}"></action>
			<action name="15" expression="#{ImpiantoAction.getSelectedType() eq '02' ? IndirizzoSpedAction.injectList(ImpRisc.sedi.indirizzoSped) : ''}"></action>
			<action name="16" expression="#{ImpiantoAction.getSelectedType() eq '03' ? IndirizzoSpedAction.injectList(ImpMonta.sedi.indirizzoSped) : ''}"></action>
			<action name="17" expression="#{ImpiantoAction.getSelectedType() eq '04' ? IndirizzoSpedAction.injectList(ImpSoll.sedi.indirizzoSped) : ''}"></action>
			<action name="18" expression="#{ImpiantoAction.getSelectedType() eq '05' ? IndirizzoSpedAction.injectList(ImpTerra.sedi.indirizzoSped) : ''}"></action>
			<action name="19" expression="#{ImpiantoAction.getSelectedType() eq '02'? SchedaGeneratoriAction.injectList(ImpRisc.schedaGeneratori):''}"></action>
			<action name="20" expression="#{ImpiantoAction.getSelectedType() eq '02'? SchedaVasiAction.injectList(ImpRisc.schedaVasi):''}"></action>
			<action name="21" expression="#{(ImpiantoAction.getSelectedType() eq '01' and ImpPress.tipoApparecchio.code eq '12') ? SchedaGeneratoriIndivAction.injectList(ImpPress.schedaGeneratoriIndiv) :''}"></action>
			<action name="22" expression="#{(ImpiantoAction.getSelectedType() eq '01' and ImpPress.tipoApparecchio.code eq '12') ? SchedaRecipientiIndivAction.injectList(ImpPress.schedaRecipientiIndiv) :''}"></action>
			<action name="23" expression="#{(ImpiantoAction.getSelectedType() eq '01' and ImpPress.tipoApparecchio.code eq '12') ? SchedaTubazioniIndivAction.injectList(ImpPress.schedaTubazioniIndiv) :''}"></action>
		</event>
		<transition to="reinject lists one element"></transition>
	</node>

	<node name="criteria just saved">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.cleanRestrictions()}"></action>
			<action name="2" expression="#{ImpiantoAction.temporary.clear()}"></action>
			<action name="3" expression="#{Impianto.code.code eq '01'? ImpiantoAction.temporary.put('01',true):''}"></action>
			<action name="4" expression="#{Impianto.code.code eq '02'? ImpiantoAction.temporary.put('02',true):''}"></action>
			<action name="5" expression="#{Impianto.code.code eq '03'? ImpiantoAction.temporary.put('03',true):''}"></action>
			<action name="6" expression="#{Impianto.code.code eq '04'? ImpiantoAction.temporary.put('04',true):''}"></action>
			<action name="7" expression="#{Impianto.code.code eq '04'? ImpSollAction.temporary.put('D',true):''}"></action>
			<action name="8" expression="#{Impianto.code.code eq '04'? ImpSollAction.temporary.put('E',true):''}"></action>
			<action name="9" expression="#{Impianto.code.code eq '04'? ImpSollAction.temporary.put('F',true):''}"></action>
			<action name="10" expression="#{Impianto.code.code eq '04'? ImpSollAction.temporary.put('G',true):''}"></action>
			<action name="11" expression="#{Impianto.code.code eq '04'? ImpSollAction.temporary.put('H',true):''}"></action>
			<action name="12" expression="#{Impianto.code.code eq '04'? ImpSollAction.temporary.put('I',true):''}"></action>
			<action name="13" expression="#{Impianto.code.code eq '04'? ImpSollAction.temporary.put('L',true):''}"></action>
			<action name="14" expression="#{Impianto.code.code eq '05'? ImpiantoAction.temporary.put('05',true):''}"></action>
			<action name="15" expression="#{Impianto.code.code eq '05'? ImpTerraAction.temporary.put('A',true):''}"></action>
			<action name="16" expression="#{Impianto.code.code eq '05'? ImpTerraAction.temporary.put('B',true):''}"></action>
			<action name="17" expression="#{Impianto.code.code eq '05'? ImpTerraAction.temporary.put('C',true):''}"></action>
		</event>
		<transition to="eject SA"></transition>
	</node>

	<decision name="coming from anag?" expression="#{ImpiantoAction.temporary['anag'] == true}">
		<transition to="super-state7/update old si deletable" name="true"></transition>
		<transition to="super-state7/update old si deletable" name="false"></transition>
	</decision>

	<task-node name="popup delete imp">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setPopupViewId('/MOD_Anagrafiche/CORE/FORMS/popup_delImpianto')}"></action>
		</event>
		<transition to="popup del button?"></transition>
	</task-node>

	<decision name="popup del button?" expression="#{button.mnemonic}">
		<transition to="super-state2/Delete Impianto" name="BtnConfirmDel"></transition>
		<transition to="eject" name="BtnCancel"></transition>
	</decision>

	<task-node name="popup delete imp 2">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setPopupViewId('/MOD_Anagrafiche/CORE/FORMS/popup_delImpianto')}"></action>
		</event>
		<transition to="popup del button 2"></transition>
	</task-node>

	<task-node name="popup delete imp 3">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setPopupViewId('/MOD_Anagrafiche/CORE/FORMS/popup_delImpianto')}"></action>
		</event>
		<transition to="popup del button 3"></transition>
	</task-node>

	<decision name="popup del button 2" expression="#{button.mnemonic}">
		<transition to="injectImp" name="BtnConfirmDel"></transition>
		<transition to="eject" name="BtnCancel"></transition>
	</decision>

	<decision name="popup del button 3" expression="#{button.mnemonic}">
		<transition to="PrepareDelete" name="BtnConfirmDel"></transition>
		<transition to="eject" name="BtnCancel"></transition>
	</decision>

	<task-node name="Check Duplicated">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setPopupViewId('/MOD_Company/CORE/FORMS/popupCheckDuplicated')}"></action>
		</event>
		<transition to="CleanCheck"></transition>
	</task-node>

	<node name="SetCheck">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.isDuplicate(Impianto)}"></action>
		</event>
		<transition to="Check Duplicated"></transition>
	</node>

	<node name="CleanCheck">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.temporary.remove('check')}"></action>
		</event>
		<transition to="Crea Impianto"></transition>
	</node>

	<process-state name="Edit SiglaMatricolaTipoAnno">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/editSiglaTipoMatricolaAnno" binding="late"></sub-process>
		<transition to="Crea Impianto"></transition>
	</process-state>

	<process-state name="StatusHistory">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/StatusHistory" binding="late"></sub-process>
		<transition to="Crea Impianto"></transition>
	</process-state>

	<decision name="status ok?" expression="#{ImpiantoAction.checkStatoImpianto()}">
		<transition to="Impianto?" name="true"></transition>
		<transition to="warn" name="false"></transition>
	</decision>

	<task-node name="warn">
		<task>
			<assignment actor-id="#{userBean.username}"></assignment>
		</task>
		<event type="node-enter">
			<action name="main" expression="#{ViewManager.setPopupViewId('/MOD_Company/CORE/FORMS/p_warning_status')}"></action>
		</event>
		<event type="node-leave">
			<action name="1" expression="#{ImpiantoAction.temporary.remove('warningMsg')}"></action>
		</event>
		<transition to="Impianto?"></transition>
	</task-node>

	<node name="inject addebiti">
		<event type="node-enter">
			<action name="1" expression="#{AddebitoAction.equal.remove('impPress.internalId')}"></action>
			<action name="2" expression="#{AddebitoAction.equal.remove('impRisc.internalId')}"></action>
			<action name="3" expression="#{AddebitoAction.equal.remove('impMonta.internalId')}"></action>
			<action name="4" expression="#{AddebitoAction.equal.remove('impSoll.internalId')}"></action>
			<action name="5" expression="#{AddebitoAction.equal.remove('impTerra.internalId')}"></action>
			<action name="6" expression="#{ImpiantoAction.getSelectedType()=='01'?AddebitoAction.equal.put('impPress.internalId',ImpPress.internalId):''}"></action>
			<action name="7" expression="#{ImpiantoAction.getSelectedType()=='02'?AddebitoAction.equal.put('impRisc.internalId',ImpRisc.internalId):''}"></action>
			<action name="8" expression="#{ImpiantoAction.getSelectedType()=='03'?AddebitoAction.equal.put('impMonta.internalId',ImpMonta.internalId):''}"></action>
			<action name="9" expression="#{ImpiantoAction.getSelectedType()=='04'?AddebitoAction.equal.put('impSoll.internalId',ImpSoll.internalId):''}"></action>
			<action name="10" expression="#{ImpiantoAction.getSelectedType()=='05'?AddebitoAction.equal.put('impTerra.internalId',ImpTerra.internalId):''}"></action>
			<action name="11" expression="#{AddebitoAction.read()}"></action>
			<action name="12" expression="#{AlfrescoDocumentAction.injectList(ImpiantoAction.getAllDocuments(AlfrescoDocumentList.list, VerificaImpList.list, AddebitoList.list))}"></action>
		</event>
		<transition to="injectList of docs"></transition>
	</node>

	<node name="eject impianto">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.eject()}"></action>
		</event>
		<transition to="to End"></transition>
	</node>

	<node name="eject impianto2">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.eject()}"></action>
		</event>
		<transition to="to End"></transition>
	</node>

	<node name="backup PG">
		<event type="node-enter">
			<action name="1" expression="#{org.jboss.seam.core.conversationContext.set('pgImp',PersoneGiuridiche)}"></action>
		</event>
		<transition to="Button1?"></transition>
	</node>

	<node name="restore PG">
		<event type="node-enter">
			<action name="1" expression="#{not empty pgImp ? PersoneGiuridicheAction.inject(pgImp):''}"></action>
			<action name="2" expression="#{org.jboss.seam.core.conversationContext.remove('pgImp')}"></action>
			<action name="3" expression="#{SediAction.ejectList()}"></action>
			<action name="4" expression="#{SediAction.cleanRestrictions()}"></action>
		</event>
		<transition to="end-state1"></transition>
	</node>

	<node name="to End">
		<transition to="restore PG"></transition>
	</node>

	<node name="auto fill">
		<event type="node-enter">
			<action name="1" expression="#{ImpiantoAction.fillOtherFieldsFromSedeInst(SediInstallazione.sede.personaGiuridica, ImpiantoAction.getSelectedType())}"></action>
		</event>
		<transition to="preset"></transition>
	</node>

	<node name="Set Temporary ditta">
		<event type="node-enter">
			<action name="1" expression="#{PersoneGiuridicheAction.temporary.put('sediInstVisible',true)}"></action>
		</event>
		<transition to="pennone"></transition>
	</node>

	<process-state name="pennone">
		<sub-process name="MOD_Company/CORE/PROCESSES/Utilities/pennone" binding="late"></sub-process>
		<transition to="Remove Temporary ditta"></transition>
	</process-state>

	<node name="Remove Temporary ditta">
		<transition to="saved?"></transition>
	</node>

	<node name="update SI deletable">
		<event type="node-enter">
			<action name="1" expression="#{SediInstallazione.setDeletable(SediInstallazioneAction.isDeletable(SediInstallazione))}"></action>
		</event>
		<transition to="eject"></transition>
	</node>

	<super-state name="super-state7">
		<node name="update old si deletable">
			<event type="node-enter">
				<action name="1" expression="#{SediInstallazioneAction.manageOldSiDeletable(si)}"></action>
			</event>
			<transition to="../eject SA"></transition>
		</node>
	</super-state>


	<end-state name="end-state1"></end-state>


</process-definition>